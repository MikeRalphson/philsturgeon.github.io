<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Representing State in REST and GraphQL | Phil Sturgeon</title>
  <meta name="description" content="Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.jpg" rel="icon" type="image/jpg" />

  <meta property="og:title" content="Representing State in REST and GraphQL" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="It&#x27;s very common for APIs to be treated like &quot;databases over HTTP&quot;, with clients expected to infer state from a collection of boolean switches and date fields. Stop this with HATEOAS." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/api/2017/06/19/representing-state-in-rest-and-graphql/" />
  <meta property="og:locale" content="en_GB" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Representing State in REST and GraphQL | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/api/2017/06/19/representing-state-in-rest-and-graphql/">
  <meta name="twitter:description" content="It&#x27;s very common for APIs to be treated like &quot;databases over HTTP&quot;, with clients expected to infer state from a collection of boolean switches and date fields. Stop this with HATEOAS.">
  <meta name="twitter:creator" content="@philsturgeon">

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Representing State in REST and GraphQL</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2017-06-19 22:56:00 UTC">
                Jun 19 2017
              </time>
              <a href="/tag/hypermedia/">#hypermedia</a>
              <a href="/tag/hateoas/">#hateoas</a>
              <a href="/tag/graphql/">#graphql</a>
              <a href="/tag/rest/">#rest</a>
              <a href="/tag/api/">#api</a>
              <a href="/tag/http/">#http</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <hr>

          <p>Representing state is a complex thing. At my last two jobs, it's been very common for APIs to be treated like "databases over HTTP". The fields are sent up and down from the server to multiple mobile/web apps, and there's not too much else going on.</p>

<p>Over time, we noticed this specific problem happening over and over again: When you ask the clients to infer state from the fields alone, they often infer things differently. More than that, even if they infer the correct state <em>right now</em>, it might not be the correct state in a few months.</p>

<p>What the hell am I going on about?</p>

<p>An example!</p>

<p>Let's talk about invoices. Our API could be REST, RESTish or GraphQL, doesn't matter. We have a basic object with a bunch of date fields:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invoice"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"093b941d"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"published_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:31:01Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sent_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:34:29Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"paid_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>We tell the clients that if there is no paid date, then it has not been paid, and the same logic applies for sent. It might look a bit like this:</p>

<pre class="highlight javascript"><code><span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">paid_at</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">status</span> <span class="o">=</span> <span class="s1">'paid'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">sent_at</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">status</span> <span class="o">=</span> <span class="s1">'sent'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">published_at</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">status</span> <span class="o">=</span> <span class="s1">'published'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">status</span> <span class="o">=</span> <span class="s1">'draft'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>

<p>This means we can display <code>Status: Sent</code> on our various client applications, and it's likely all the apps got that right.</p>

<p>Soon we notice a situation where the payment is initiated, but the payment bounces. Maybe we add another field, and this whole "inspect the dates" thing starts to fall apart.</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invoice"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"093b941d"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"published_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:31:01Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sent_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:34:29Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"paid_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-16 09:05:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"payment_received_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A client inferring state from those fields would consider that invoice paid. Another client would consider it to be an unpaid invoice, as there was a failed payment. If a new "published" state was added, they'd be showing as draft. Mess all over.</p>

<p>Of course, folks will say "well you shouldn't change things without versioning", but even if we started with the 2nd example of that JSON and never changed anything, multiple clients could interpret those fields differently.</p>

<p>Changing things without versioning is sometimes known as <a href="https://www.mnot.net/blog/2012/12/04/api-evolution">API evolution</a>, and whilst you shouldn't go running about breaking things willy nilly, you should be able to add to an API without clients exploding. GraphQL is advertising people use evolution right on their homepage, so it's not an alien concept.</p>

<h2 id="api--database">API != Database</h2>

<p>Inferring states from dates or other arbitrary fields is awful, and it <em>always</em> goes wrong. I noticed a similar issue with Postmates Fleet saying "Waiting on verification of your profile image" on the mobile app, and the web app said "Please upload a profile image". If I dug into the code, I'd bet they were looking for an "image verified" switch of some sort, and the web app just happened to notice a field that the mobile app didn't.</p>

<p>This is one of many many many reasons why folks need to stop treating an API like it is purely SQL-over-HTTP. The data can be stored like this in the <em>database</em>, but exposing it in the contract is begging for trouble, as clients will always end up with a slightly different picture of the current state.</p>

<p>How do you avoid this? State machines!</p>

<p>In the world of Ruby there are loads of options, but <a href="https://github.com/gocardless/statesman">Statesman</a> is super simple, and <a href="https://github.com/aasm/aasm">AASM</a> is cool.</p>

<p>Let's look at this just in code, and ignore HTTP for a second.</p>

<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">InvoiceStateMachine</span>
  <span class="kp">include</span> <span class="no">Statesman</span><span class="o">::</span><span class="no">Machine</span>

  <span class="n">state</span> <span class="ss">:draft</span><span class="p">,</span> <span class="ss">initial: </span><span class="kp">true</span>
  <span class="n">state</span> <span class="ss">:published</span>
  <span class="n">state</span> <span class="ss">:sent</span>
  <span class="n">state</span> <span class="ss">:failed</span>
  <span class="n">state</span> <span class="ss">:paid</span>

  <span class="n">transition</span> <span class="ss">from: :draft</span><span class="p">,</span>        <span class="ss">to: :published</span>
  <span class="n">transition</span> <span class="ss">from: :published</span><span class="p">,</span>    <span class="ss">to: </span><span class="p">[</span><span class="ss">:draft</span><span class="p">,</span> <span class="ss">:sent</span><span class="p">,</span> <span class="ss">:paid</span><span class="p">]</span>
  <span class="n">transition</span> <span class="ss">from: :sent</span><span class="p">,</span>         <span class="ss">to: </span><span class="p">[</span><span class="ss">:failed</span><span class="p">,</span> <span class="ss">:paid</span><span class="p">]</span>
  <span class="n">transition</span> <span class="ss">from: :failed</span><span class="p">,</span>       <span class="ss">to: :paid</span>

  <span class="n">guard_transition</span><span class="p">(</span><span class="ss">to: :sent</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoice</span><span class="o">|</span>
    <span class="n">invoice</span><span class="p">.</span><span class="nf">has_contact_info?</span>
  <span class="k">end</span>

  <span class="n">before_transition</span><span class="p">(</span><span class="ss">to: :sent</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoice</span><span class="p">,</span> <span class="n">transition</span><span class="o">|</span>
    <span class="no">EmailService</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">invoice</span><span class="p">).</span><span class="nf">send_contact_invoice</span>
    <span class="n">invoice</span><span class="p">.</span><span class="nf">touch</span><span class="p">(</span><span class="ss">:sent_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">after_transition</span><span class="p">(</span><span class="ss">to: :failed</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoice</span><span class="p">,</span> <span class="n">transition</span><span class="o">|</span>
    <span class="no">EmailService</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">invoice</span><span class="p">).</span><span class="nf">send_contact_failure</span>
    <span class="no">EmailService</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">invoice</span><span class="p">).</span><span class="nf">send_owner_failure</span>
    <span class="n">invoice</span><span class="p">.</span><span class="nf">touch</span><span class="p">(</span><span class="ss">:failed_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">after_transition</span><span class="p">(</span><span class="ss">to: :paid</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoice</span><span class="p">,</span> <span class="n">transition</span><span class="o">|</span>
    <span class="no">EmailService</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">invoice</span><span class="p">).</span><span class="nf">send_owner_success</span>
    <span class="n">invoice</span><span class="p">.</span><span class="nf">touch</span><span class="p">(</span><span class="ss">:paid_at</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Now we can do this:</p>

<pre class="highlight plaintext"><code>invoice.current_state # =&gt; "draft"
invoice.allowed_transitions # =&gt; ["published"]
invoice.can_transition_to?(:sent) # =&gt; true/false
invoice.transition_to(:paid) # =&gt; true/false
</code></pre>

<p>This gives us a lot of ability to assert a single "status", and you know the server has everything under control. We've not had to spread that logic throughout persistence layer logic, controller logic, and arbitrary classes. It's all in the state machine, and the main thing is that we no longer have to ask the clients to try and guess what's up with the invoice.</p>

<h2 id="exposing-state-over-http">Exposing State over HTTP</h2>

<p>Just like the Ruby example, we want to know the current state, and we want to know what we can do next.</p>

<p>First thing? Shove that <code>current_state</code> property in your serializer to expose a <code>"status": "draft"</code> field in the output. This'll work fine for both RESTish APIs and those built with GraphQL.</p>

<p>How about the "what to do next" bit?  Well, this is exactly what HATEOAS is!</p>

<h3 id="hateoas-i-call-on-thee">HATEOAS I CALL ON THEE</h3>

<p>"Hypermedia As The Engine Of Application State" is a concept that's ignored by many, but it's what makes a REST API so powerful.</p>

<p>At it's most basic, starting to implement some HATEOAS in your API would look like this:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invoice"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"093b941d"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:31:01Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sent_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-15 12:34:29Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"paid_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-06-16 09:05:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"payment_received_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"published"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"pay"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.acme.com/invoices/093b941d/payment_attempts"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The existence of that <code>pay</code> link can be used to let the various client apps know they should show the "Pay" button. If it wasn't <code>published</code> that link wouldn't be there.</p>

<p>This theoretically works, although it is not super clear exactly what a client needs to do from the existence of this pay link alone.</p>

<p>What HTTP method should be used?
What fields need to be sent?
What mime type should be put in <code>Accept</code>?</p>

<p>There are a few ways HATEOAS can help.</p>

<h4 id="options--meta-data">OPTIONS + Meta Data</h4>

<p>A client could call <code>OPTIONS /invoices/093b941d/payment_attempts</code> and get a response with metadata about the document.</p>

<p>What actions are available. What fields can be updated. What data do those fields expect?</p>

<p>Sometimes people make <a href="http://zacstewart.com/2012/04/14/http-options-method.html">homegrown solutions</a>, and some folks leverage tools like <a href="http://json-schema.org/">JSON Schema</a> for the fields part.</p>

<h4 id="hyper-schema">Hyper Schema</h4>

<p>Another approach is <a href="http://json-schema.org/latest/json-schema-hypermedia.html">JSON Hyper-Schema</a>, which is a draft spec. Is essentially an extension to JSON Schema, which adds <code>links</code> keywords! Instead of making your own <code>OPTIONS</code> metadata and linking to JSON Schema, this Hyper-Schema could be the entire OPTIONS response!</p>

<p>If hiding it behind options seems weird, you can also/either place a link in the response document:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://api.acme.com/schemas/invoice/093b941d"</span><span class="w">
  </span><span class="s2">"data"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></code></pre>

<p>Using metadata to let clients know what data they should send is very cool, as it offers a method for client-side validation which matches server-side validation perfectly. Now your various applications can use that JSON Schema to validate data locally before even trying the POST (saving time and reducing traffic to the server).</p>

<h4 id="hypermedia-friendly-formats">Hypermedia-friendly Formats</h4>

<p>Instead of two requests, another approach is combining the metadata with the response document. Our example so far has been using <a href="http://jsonapi.org/">JSON-API</a>, so to continue using that:</p>

<pre class="highlight plaintext"><code>"links": {
  "pay": {
    "href": "https://api.acme.com/invoices/093b941d/payment_attempts"
    "meta": {
      "method": "POST",
      "type": "application/json"
    }
  }
}
</code></pre>

<p>This isn't really part of the JSON-API specification, but <a href="http://jsonapi.org/format/#document-links">it is valid</a>. Inventing your own standards and conventions can be a pain in the ass, so maybe don't bother. There's a standard for that: <a href="https://github.com/kevinswiber/siren">Siren</a>.</p>

<p>Check out this potential JSON response.</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"invoice"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"093b941d"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"all_the_other"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fields"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"so_many"</span><span class="p">:</span><span class="w"> </span><span class="s2">"other_fields"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"published"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"items"</span><span class="p">,</span><span class="w"> </span><span class="s2">"collection"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"http://acme.com/rels/pay-invoice"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.acme.com/invoices/093b941d/payment_attempts"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay-invoice"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pay Invoice"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.acme.com/invoices/093b941d/payment_attempts"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invoice_number"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hidden"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amount"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"number"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stripe_token"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"self"</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://api.acme.com/invoices/093b941d"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"previous"</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://api.acme.com/invoices/a46c437c"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"next"</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://api.acme.com/invoices/ca0e7f36"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Perfect!</p>

<p>We know which HTTP method to use. We know what fields to send. We know the data types of the fields. We don't know a huge amount about what to put in those fields, but it's a start.</p>

<p>How easy would it be to hook that response up to an "Actions" dropdown, and dynamically have the interface built out from it? You could roll out certain features to your client applications <em>without touching the client code</em>.</p>

<p>You can finally fire Gary!</p>

<p>There's quite a few <a href="https://sookocheff.com/post/api/on-choosing-a-hypermedia-format/">other data formats</a> that support hypermedia, including the awesomely named <a href="http://www.markus-lanthaler.com/hydra/">Hydra</a>.</p>

<h2 id="actions-seem-unresty">Actions seem unRESTy</h2>

<p>Something I've said <a href="https://www.smashingmagazine.com/2016/09/understanding-rest-and-rpc-for-http-apis/">fairly recently</a> is that "actions are RPC" ('remote procedure call'), which is… semi accurate. If an API is nothing but actions then it is probably better off as RPC. I'm building a permissions API that accepts a bunch of parameters, then returns true or false if the user has permission. That can stay as RPC.</p>

<p>REST is all about a beautiful mixture of data, relationships and actions. Taken from the Siren homepage is this lovely quote:</p>

<blockquote>
  <p>It's important to note the distinction between link relations and classes. Link relations define a relationship between two resources. Classes define a classification of the nature of the element, be it an entity or an action, in its current representation.</p>
</blockquote>

<p>They continue to fit their "add item" link in with the usual expectations for collections and resources, and the add item is still <code>"href": "http://api.x.io/orders/42/items",</code>. This mixture of actions and data actually lines up rather well with what I've said in that article.</p>

<p>A <a href="http://www.ustream.tv/recorded/102891495">recent talk from Mike Amundsen</a> goes through a number of topics, but specifically Hypermedia (HATEOAS) as a collection of affordances (potential actions that can taken). This quote was up in there:</p>

<p><img src="/images/article_images/2017-06-15-representing-state-in-rest-and-graphql/information-and-controls.png" class="data-no-caption" /></p>

<p>Information and actions, displayed up to a user through a self-documenting format of awesomeness, with a selection of links that turn a well-tuned client into a crawler instead of just being a CRUD exchange… well that's the whole point of REST.</p>

<h2 id="to-hateoas-or-not-to-hateoas">To HATEOAS or not to HATEOAS</h2>

<p>We know that if you don't have HATEOAS, <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">you only have a RESTish API</a>.</p>

<p>HATEOAS is a really useful concept, which solves so many issues I've run into time and time again. I don't think every API needs to use HATEOAS by any means, and simple (micro)services often wont.</p>

<p>Regardless of needing it, I definitely think people should understand what it is. The main reason? People should know what they're missing when they call GraphQL "REST 2.0". GraphQL has no ability to offer HATEOAS<sup>*</sup>, and as such is essentially a <em>subset</em> of REST, and not a "new version".</p>

<p>A lot of the <a href="https://blog.runscope.com/posts/you-might-not-need-graphql">cool stuff you can do in GraphQL can be done in REST</a>, but GraphQL has no HATEOAS. Maybe think about that.</p>

<p>Sure waiting for links before working out what to do next is slower for mobile applications that need to function as blazingly fast as possible over crap networks, but REST has solutions to that, and to be honest server-to-server doesn't always need to trim bits.</p>

<p>If you're really set on using GraphQL but want to make sure you're representing state and not forcing clients to guess, at least implement a state machine and add that <code>status</code> field.</p>

<p>Finally, if you're not doing any of this stuff then stop calling it a REST API. RESTish will do. 👍</p>

<p><em>Thanks to the small army of people who battled through my nonsense first drafts in an effort to make me sound intelligent. You know who you are, but especially <a href="http://twitter.com/dstockto">@dstockto</a>, <a href="http://twitter.com/glasnt">@glasnt</a>, and <a href="http://twitter.com/mwop">@mwop</a>.</em></p>

<p><em><sup>*</sup> I'm sure you could find some way to hack HATEOAS support into GraphQL, like a field with an array of potential mutators that are available, but it'll be a bit of a mess and you'd need to request specific pieces of metadata making the queries huge. The majority of REST &amp; RESTish APIs have ignored HATEOAS for years, so I don't expect a stampede of GraphQL developers trying to mash it into a query language that was designed to exclude it.</em></p>

          <hr>
<p>More on GraphQL:</p>
<ul>
  <li>
    <a href='/api/2017/01/24/graphql-vs-rest-overview/'>GraphQL vs REST: Overview</a>
  </li>
  <li>
    <a href='/api/2017/01/26/graphql-vs-rest-caching/'>GraphQL vs REST: Caching</a>
  </li>
  <li>
    <a href='/api/2017/04/18/you-might-not-need-graphql/'>You Might Not Need GraphQL</a>
  </li>
  <li>
    <a href='/api/2017/06/19/representing-state-in-rest-and-graphql/'>Representing State in REST and GraphQL</a>
  </li>
</ul>
<p>
  <em>If you appreciate these articles and want me to keep them coming, fire some coins over. Maybe I'll even run the next one through a spell checker.</em>
</p>
<p>
  <em>
    <strong>bitcoin</strong> - 1PNbuCjgATjaaHtq7zZKqe3FBL7ngyDi23<br/>
    <strong>etherium</strong> - 0x507d6E943885a5AeD76Fa3C43dB5C73a0f1Dc792
  </em>
</p>

        </section>
        <footer class="post-footer">
            <section class="share">
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/api/2017/04/18/you-might-not-need-graphql/">You Might Not Need GraphQL</a>
                </p>
                <p style="float:right">
                    Next:
                    <a class="button" href="/api/2017/07/20/my-vision-for-a-perfect-world-in-api-specification/">Chasing the Perfect API Specification Workflow</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';


          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/cover.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
      <li>
        <a href='/speaking'>Speaking</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/philsturgeon'>GitHub</a>
      </li>
      <li>
        <a href='http://apibusters.com/'>API Busters Podcast</a>
      </li>
      <li>
        <a href='http://phil.bike/'>Phil.Bike</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/api/2018/04/13/openapi-and-json-schema-divergence-solved/">OpenAPI and JSON Schema Divergence: Part 2</a></li>
          <li><a href="/api/2018/03/30/openapi-and-json-schema-divergence/">OpenAPI and JSON Schema Divergence: Part 1</a></li>
          <li><a href="/api/2018/03/01/api-specification-workflow-matures/">Design-first API Specification Workflow Matures</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
