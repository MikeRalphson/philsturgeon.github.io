<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Dredd v1.1.0: A Bit Different | Phil Sturgeon</title>
  <meta name="description" content="Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.jpg" rel="icon" type="image/jpg" />

  <meta property="og:title" content="Dredd v1.1.0: A Bit Different" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="A new version of Dredd - the API Documentation testing tool from Apiary Inc. - has been released, and it has changed
 a few things for the better. During the upgrade at Ride I ran into a few problems, mostly based around how we had
 been using Dredd and API Blueprint." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/api/2016/06/20/dredd-v1-1-0-a-bit-different/" />
  <meta property="og:locale" content="en_GB" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Dredd v1.1.0: A Bit Different | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/api/2016/06/20/dredd-v1-1-0-a-bit-different/">
  <meta name="twitter:description" content="A new version of Dredd - the API Documentation testing tool from Apiary Inc. - has been released, and it has changed
 a few things for the better. During the upgrade at Ride I ran into a few problems, mostly based around how we had
 been using Dredd and API Blueprint.">
  <meta name="twitter:creator" content="@philsturgeon">

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Dredd v1.1.0: A Bit Different</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2016-06-20 18:11:00 UTC">
                Jun 20 2016
              </time>
              <a href="/tag/http/">#http</a>
              <a href="/tag/api/">#api</a>
              <a href="/tag/dredd/">#dredd</a>
              <a href="/tag/apiblueprint/">#apiblueprint</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <hr>

          <p>A new version of Dredd - the API Documentation testing tool from <a href="https://apiary.io/">Apiary Inc.</a> - has been released, and it has changed
 a few things for the better. During the upgrade at <a href="https://ride.com/">Ride</a> I ran into a few problems, mostly based around how we had
 been using Dredd and <a href="https://apiblueprint.org/">API Blueprint</a>.</p>

<p><em>I've blogged about Dredd and API Blueprint a few times, <a href="https://philsturgeon.uk/api/2015/01/28/dredd-api-testing-documentation/">covering the concept and workflow</a>, and
later showing off more in-depth how you can <a href="https://philsturgeon.uk/api/2015/10/08/http-documentation-with-api-blueprint/">structure your API Documentation</a>. This is still the
approach we use, and if you're not familiar with Dredd maybe head over to one of those.</em></p>

<p><a href="https://github.com/apiaryio/dredd/releases/tag/v1.1.0">v1.1.0</a> was released June 17th, and whilst it's not exactly a new iPhone or a driverless car, I'm excited. One of
the main things they snuck in there is <a href="https://github.com/apiaryio/dredd#supported-api-description-formats">experimental support for Swagger</a>! I've not had a play with that yet, but
it's great that they're starting to support both, especially as <a href="https://blog.apiary.io/2016/01/18/We-ve-got-Swagger">Apiary supports Swagger too</a>.</p>

<h2 id="nullable">Nullable</h2>

<p>One thing I noticed was support for the <code>nullable</code>. <a href="https://twitter.com/ntmlk">Adam Kliment</a> - author of Dredd -
created a <a href="https://gist.github.com/netmilk/ca5f39e607336e81edea">hack hook to support nullable</a>, but it was very much a workaround. We had to shove a
<code>#nullable</code> at the end of the line.</p>

<pre class="highlight markdown"><code><span class="p">-</span> started_at: <span class="sb">`2015-01-07T14:03:43Z`</span> (string, nullable) - #nullable
</code></pre>

<p>Now - I think due to switching from Protagonist to <a href="https://github.com/apiaryio/fury.js">Fury.js</a> - we can remove the hook and the hacktag.</p>

<pre class="highlight markdown"><code><span class="p">-</span> started_at: <span class="sb">`2015-01-07T14:03:43Z`</span> (string, nullable)
</code></pre>

<h2 id="multiple-response-testing">Multiple Response Testing</h2>

<p>The main thing I noticed, was that Dredd was now testing all multiple responses. Multiple responses look like this:</p>

<pre class="highlight markdown"><code><span class="gu">## Avatar collection [/avatars]</span>

<span class="gu">### Upload an avatar [POST]</span>
<span class="p">
+</span> Request (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - avatars (object)
          - avatar_url: `http://example.org/some-actual-file.jpg`

</span><span class="p">+</span> Response 201 (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - avatars (Avatar Full)

</span><span class="p">+</span> Response 415 (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - errors (array[Error Unsupported Media Type])
</span></code></pre>

<p>This was really common in our API, as a way to show that you might get an important error. We don't show every possible
 error sure, but if something seemed unique or interested it would go in.</p>

<p>Using previous versions of Dredd, if you had multiple responses, you would see the following:</p>

<pre class="highlight plaintext"><code>warn: Runtime compilation warning: Multiple responses, using first.
 on Avatar &gt; Avatar collection &gt; Upload an avatar
</code></pre>

<p>Now, Dredd will give them all a go!</p>

<p>The downside to Dredd trying to run new tests is that it will probably break your build. Seeing as the request is built identically, the response will be identical, and the test will fail! Instead of getting a <code>415</code> here, we'll
end up getting a <code>200</code>.</p>

<p>To get around this I had to abandon multiple responses (boo!) and switch to using two request transactions, like this:</p>

<pre class="highlight markdown"><code><span class="gu">## Avatar collection [/avatars]</span>

<span class="gu">### Upload an avatar [POST]</span>
<span class="p">
+</span> Request OK (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - avatars (object)
          - avatar_url: `http://example.org/some-actual-file.jpg`

</span><span class="p">+</span> Response 201 (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - avatars (Avatar Full)

</span><span class="p">+</span> Request Unsupported Media Type (image/gif)
<span class="p">
+</span> Response 415 (application/json; charset=utf-8)<span class="sb">

    + Attributes
        - errors (array[Error Unsupported Media Type])
</span></code></pre>

<p>Notice here the first request now has a name, <code>Request OK</code>, which can be arbitrary string (within reason). I chose to
stick to the HTTP status reason so it matches, as that seemed like as good a convention as any.</p>

<p>You'll also notice another change, I've added a new named request: <code>Request Unsupported Media Type</code>. That <code>image/gif</code>
will trigger the API to respond with an error, as we only accept <code>application/json</code>, <code>image/jpeg</code> or <code>image/png</code> for
that endpoint. Now that it is a new transaction it wont conflict with the <code>OK</code> test, and we're all green!</p>

<h2 id="thanks">Thanks!</h2>

<p>Great job from the Dredd contributors, I saw <a href="https://twitter.com/honzajavorek">Honza Javorek</a>'s name show up a whole bunch in the <a href="https://github.com/apiaryio/dredd/blob/master/CHANGELOG.md">changelog</a> and know a lot of others put in serious effort too.</p>


          <hr>
<p>
  <em>If you appreciate these articles and want me to keep them coming, fire some coins over. Maybe I'll even run the next one through a spell checker.</em>
</p>
<p>
  <em>
    <strong>bitcoin</strong> - 1PNbuCjgATjaaHtq7zZKqe3FBL7ngyDi23<br/>
    <strong>etherium</strong> - 0x507d6E943885a5AeD76Fa3C43dB5C73a0f1Dc792
  </em>
</p>

        </section>
        <footer class="post-footer">
            <section class="share">
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/php/2016/05/31/why-care-about-php-middleware/">Why Care About PHP Middleware?</a>
                </p>
                <p style="float:right">
                    Next:
                    <a class="button" href="/charity/2016/06/22/techbikers/">TechBikers 2016</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';


          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/cover.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
      <li>
        <a href='/speaking'>Speaking</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/philsturgeon'>GitHub</a>
      </li>
      <li>
        <a href='http://apibusters.com/'>API Busters Podcast</a>
      </li>
      <li>
        <a href='http://phil.bike/'>Phil.Bike</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/api/2018/04/13/openapi-and-json-schema-divergence-solved/">OpenAPI and JSON Schema Divergence: Part 2</a></li>
          <li><a href="/api/2018/03/30/openapi-and-json-schema-divergence/">OpenAPI and JSON Schema Divergence: Part 1</a></li>
          <li><a href="/api/2018/03/01/api-specification-workflow-matures/">Design-first API Specification Workflow Matures</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
