<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Building REST APIs with Rails: Basic Serialization | Phil Sturgeon</title>
  <meta name="description" content="Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.jpg" rel="icon" type="image/jpg" />

  <meta property="og:title" content="Building REST APIs with Rails: Basic Serialization" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="Third video in a pile of LiveCoding.tv videos, shows how to use ActiveModel Serializer to shape the output of your resources. I totally forgot how links work, so watch me flap around trying to get it working and chuckle as I flail." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/api/2016/12/11/building-rest-apis-with-rails-basic-serialization/" />
  <meta property="og:locale" content="en_GB" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Building REST APIs with Rails: Basic Serialization | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/api/2016/12/11/building-rest-apis-with-rails-basic-serialization/">
  <meta name="twitter:description" content="Third video in a pile of LiveCoding.tv videos, shows how to use ActiveModel Serializer to shape the output of your resources. I totally forgot how links work, so watch me flap around trying to get it working and chuckle as I flail.">
  <meta name="twitter:creator" content="@philsturgeon">

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Building REST APIs with Rails: Basic Serialization</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2016-12-11 00:24:23 UTC">
                Dec 11 2016
              </time>
              <a href="/tag/building-rest-apis-in-rails/">#building-rest-apis-in-rails</a>
              <a href="/tag/http/">#http</a>
              <a href="/tag/api/">#api</a>
              <a href="/tag/ams/">#ams</a>
              <a href="/tag/video/">#video</a>
              <a href="/tag/serialization/">#serialization</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>More videos in this practice series "Building REST APIs with Rails":</p>
<ul>
  <li>
    Episode 1:
    <a href='/api/2016/11/22/apis-documentation-first/'>Documenting Your API First</a>
  </li>
  <li>
    Episode 2:
    <a href='/api/2016/12/02/mocking-apis-with-api-blueprint/'>Mocking APIs with API Blueprint</a>
  </li>
  <li>
    Episode 3:
    <a href='/api/2016/12/11/building-apis-with-rails-basic-serialization/'>Basic Serialization</a>
  </li>
  <li>
    Episode 4:
    <a href='/api/2016/12/21/building-rest-apis-with-rails-documentation-testing/'>Documentation Testing</a>
  </li>
  <li>
    Episode 5 & 6:
    <a href='/api/2017/01/03/building-apis-with-rails-handling-errors-nicely/'>Handling Errors Nicely</a>
  </li>
</ul>
<hr>

          <p>Third video in a pile of <a href="http://livecoding.tv/philsturgeon/">LiveCoding.tv</a> videos, shows how to use <a href="https://github.com/rails-api/active_model_serializers/blob/master/docs/general/getting_started.md">ActiveModel Serializer</a> to shape the output of your resources. I totally forgot how links work, so watch me flap around trying to get it working and chuckle as I flail.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/A4XLCSZBN24" frameborder="0" allowfullscreen=""></iframe>

<p><strong><a href="https://github.com/philsturgeon/livecoding-apisyouwonthate/tree/master/episode-03-building-in-rails">Source Code</a></strong></p>

<hr />

<h2 id="notes">Notes</h2>

<p>To get going, you'll need to include in your <code>Gemfile</code>:</p>

<pre class="highlight plaintext"><code>gem 'active_model_serializers', '~&gt; 0.10.0'
</code></pre>

<p>Install that by running bundle:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>bundle install
</code></pre>

<p>Now there will be a new generator available, called <code>resource</code>:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>rails g resource manufacturer name:string about:string city:string country:string manufacturer:references

<span class="gp">$ </span>rails g resource product name:string description:string product_type:string apv:float image_url:string references:products
</code></pre>

<p>These fields are taken from our API Blueprint documentation, and we already know the types.</p>

<pre class="highlight shell"><code>rake db:create db:migrate
</code></pre>

<p>Create and generate the tables from our migrations, turning them into actual schema we can populate using the rails console:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>rails console
</code></pre>

<pre class="highlight ruby"><code><span class="n">manufacturer</span> <span class="o">=</span> <span class="no">Manufacturer</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Thatchers"</span><span class="p">,</span> <span class="ss">about: </span><span class="s2">"Pretty solid cider makers who are randomly moving their factories in the south west and going to Ireland..."</span><span class="p">,</span> <span class="ss">city: </span><span class="s2">"Dublin"</span><span class="p">,</span> <span class="ss">country: </span><span class="s2">"Ireland"</span><span class="p">)</span>

<span class="no">Product</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">manufacturer: </span><span class="n">manufacturer</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'Katies'</span><span class="p">,</span> <span class="ss">description: </span><span class="s2">"Unnecessarily strong fizzy cider that sells for the same price as normal ciders."</span><span class="p">,</span> <span class="ss">apv: </span><span class="mi">7</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="ss">product_type: </span><span class="s1">'cider'</span><span class="p">)</span>

<span class="no">Product</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">manufacturer: </span><span class="n">manufacturer</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'Thatchers Dry'</span><span class="p">,</span> <span class="ss">description: </span><span class="s2">"As the name suggests this is dry, and a little tangy."</span><span class="p">,</span> <span class="ss">apv: </span><span class="mi">6</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="ss">product_type: </span><span class="s1">'cider'</span><span class="p">)</span>
</code></pre>

<p>Go look at <code>./app/controllers</code> and <code>./app/serializers</code> for the restâ€¦ more notes later.</p>

<p>Don't forget to make <code>./config/initializers/serializers.rb</code> and fill it with:</p>

<pre class="highlight ruby"><code><span class="no">ActiveModelSerializers</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">adapter</span> <span class="o">=</span> <span class="ss">:json_api</span>
</code></pre>

<p>Then shove this in <code>./config/application.rb</code>:</p>

<pre class="highlight ruby"><code><span class="n">config</span><span class="p">.</span><span class="nf">after_initialize</span> <span class="k">do</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">default_url_options</span><span class="p">[</span><span class="ss">:host</span><span class="p">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'HOST'</span><span class="p">]</span> <span class="o">||</span> <span class="s1">'localhost:3000'</span>
<span class="k">end</span>
</code></pre>

<p>By the time all that's done, you should have some slick JSON-API output:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"data"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"manufacturer"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"attributes"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Thatchers"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"about"</span><span class="p">:</span><span class="s2">"Pretty solid cider makers that are ditching their factories in the south west and going to Ireland..."</span><span class="p">,</span><span class="w">
         </span><span class="nt">"city"</span><span class="p">:</span><span class="s2">"Dublin"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"country"</span><span class="p">:</span><span class="s2">"Ireland"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"relationships"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"products"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"product"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"links"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"self"</span><span class="p">:</span><span class="s2">"http://localhost:3000/manufacturers/1"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"products"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"/products?manufacturer=1"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Cheers.</p>

<h2 id="interested-in-a-proper-series">Interested in a Proper Series?</h2>

<p>These rough videos will be replaced with a nicely recorded series, and to get updates about that, just let me know your email address.</p>

<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css" />

<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>

<div id="mc_embed_signup">
<form action="//apisyouwonthate.us10.list-manage.com/subscribe/post?u=f5c5ff66d95d11dec1b88cf54&amp;id=bef95bfd48" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
    <div id="mc_embed_signup_scroll">

	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required="" />
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f5c5ff66d95d11dec1b88cf54_bef95bfd48" tabindex="-1" value="" /></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" /></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->

          <hr>
<p>
  <em>If you appreciate these articles and want me to keep them coming, fire some coins over. Maybe I'll even run the next one through a spell checker.</em>
</p>
<p>
  <em>
    <strong>bitcoin</strong> - 1PNbuCjgATjaaHtq7zZKqe3FBL7ngyDi23<br/>
    <strong>etherium</strong> - 0x507d6E943885a5AeD76Fa3C43dB5C73a0f1Dc792
  </em>
</p>

        </section>
        <footer class="post-footer">
            <section class="share">
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/api/2016/12/02/mocking-apis-with-api-blueprint/">Mocking APIs with API Blueprint</a>
                </p>
                <p style="float:right">
                    Next:
                    <a class="button" href="/api/2016/12/21/building-rest-apis-with-rails-documentation-testing/">Building APIs with Rails: Documentation Testing</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';


          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/cover.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">Platform Engineer @ WeWork who talks about APIs a lot. Programming Polyglot, Pragmatist, Centerist and Sarcasist. Ex-The League of Extraordinary Packages, PHP The Right Way, Ex-PHP-FIG, Ex-CodeIgniter, Ex-FuelPHP, Ex-PyroCMS.</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
      <li>
        <a href='/speaking'>Speaking</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/philsturgeon'>GitHub</a>
      </li>
      <li>
        <a href='http://apibusters.com/'>API Busters Podcast</a>
      </li>
      <li>
        <a href='http://phil.bike/'>Phil.Bike</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/api/2018/04/13/openapi-and-json-schema-divergence-solved/">OpenAPI and JSON Schema Divergence: Part 2</a></li>
          <li><a href="/api/2018/03/30/openapi-and-json-schema-divergence/">OpenAPI and JSON Schema Divergence: Part 1</a></li>
          <li><a href="/api/2018/03/01/api-specification-workflow-matures/">Design-first API Specification Workflow Matures</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
